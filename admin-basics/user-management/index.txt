== Управление пользователями ==

=== Общая информация ===

Linux, как и любой UNIX -- многопользовательская система. Также имеются группы
пользователей, основное предназначение которых -- облегчить управление большим
количеством пользователей, а также более точно распределить права доступа к
различным объектам системы. Пользователи и группы внутри системы обозначаются
цифровыми идентификаторами -- UID и GID, соответственно.

Пользователь может входить в одну или несколько групп. По умолчанию он входит в
группу, совпадающую с его именем. Чтобы узнать, в какие еще группы входит
пользователь, введите команду `id`, вывод её может быть примерно следующим:

----------------------------------------------------
uid=500(test) gid=500(test) группы=500(test),16(rpm)
----------------------------------------------------

Такая запись означает, что пользователь test (цифровой идентификатор 500)
входит в группы test и rpm . Разные группы могут иметь разный уровень доступа к
тем или иным каталогам; чем в большее количество групп входит пользователь, тем
больше прав он имеет в системе.

NOTE: В связи с тем, что большинство привилегированных системных утилит имеют
не SUID-, а SGID-бит, будьте предельно внимательны и осторожны в переназначении
групповых прав на системные каталоги.

=== Обвязка passwd ===

Обвязка passwd поддерживает традиционные опции passwd и утилит shadow.

*Синтаксис*:

------------------------------------
passwd [ОПЦИЯ...] [ИМЯ ПОЛЬЗОВАТЕЛЯ]
------------------------------------

Возможные опции:

-d, --delete

Удалить пароль для указанной записи.

-f, --force

Форсировать операцию.

-k, --keep-tokens

Сохранить не устаревшие пароли.

-l, --lock

Блокировать указанную запись.

--stdin

Прочитать новые пароли из стандартного ввода.

-S, --status

Дать отчет о статусе пароля в указанной записи

-u, --unlock

Разблокировать указанную запись.

-?, --help

Показать справку и выйти.

--usage

Дать короткую справку по использованию.

-V, --version

Показать версию программы и выйти.

*Код выхода*:

При успешном завершении passwd заканчивает работу с кодом выхода 0. Код выхода
1 означает, что произошла ошибка. Текстовое описание ошибки выводится на
стандартный поток ошибок.

=== Добавления нового пользователя ===

Для добавления нового пользователя используйте команды `useradd` и `passwd`:

-----------------------------------------------------------------
[root@localhost root]# useradd test1

[root@localhost root]# passwd test1
passwd: updating all authentication tokens for user test1.

You can now choose the new password or passphrase.

A valid password should be a mix of upper and lower case letters,
digits, and other characters.  You can use an 8 character long
password with characters from at least 3 of these 4 classes, or
a 7 character long password containing characters from all the
classes.  An upper case letter that begins the password and a
digit that ends it do not count towards the number of character
classes used.

A passphrase should be of at least 3 words, 11 to 40 characters
long, and contain enough different characters.

Alternatively, if no one else can see your terminal now, you can
pick this as your password: "holder5dinghy-Arm".

Enter new password:
-----------------------------------------------------------------

В результате описанных действий в системе появился пользователь test1 с
некоторым паролем. Если пароль оказался слишком слабым с точки зрения системы,
она об этом предупредит (как в примере выше). Пользователь в дальнейшем может
поменять свой пароль при помощи команды passwd -- но если он попытается
поставить слабый пароль, система откажет ему (в отличие от root) в изменении.

В (DISTRO) для проверки паролей на слабость используется модуль PAM passwdqc.

Программа `useradd` имеет множество параметров, которые позволяют менять её
поведение по умолчанию. Например, можно принудительно указать, какой будет UID
или какой группе будет приналежать пользователь.

=== Модификация пользовательских записей ===

Для модификации пользовательских записей применяется утилита `usermod`:

----------------------------------
# usermod -G audio,rpm,test1 test1
----------------------------------

Такая команда изменит список групп, в которые входит пользователь test1 --
теперь это audio, rpm, test1.

------------------------
# usermod -l test2 test1
------------------------

Будет произведена смена имени пользователя с test1 на test2.

Команды `usermod -L test2` и `usermod -U test2` соответственно временно
блокируют возможность входа в систему пользователю test2 и возвращают всё на
свои места.

Изменения вступят в силу только при следующем входе пользователя в систему.

При неинтерактивной смене или задании паролей для целой группы пользователей
используйте утилиту `chpasswd`. На стандартный вход ей следует подавать список,
каждая строка которого будет выглядеть как `<имя>:<пароль>`.

=== Удаление пользователей ===

Для удаления пользователей используйте `userdel`.

Команда `userdel test2` удалит пользователя test2 из системы. Если будет
дополнительно задан параметр -d, то будет уничтожен и домашний каталог
пользователя. Нельзя удалить пользователя, если в данный момент он еще работает
в системе.

Утилиты `vigr` и `vipw` используются для ручного редактирования файлов
`/etc/passwd` и `/etc/group`, в которых хранятся основные записи о
пользователях и группах в системе.

Не рекомендуется создавать пользователей с правами сверх необходимых.
Предпочтительнее создать серию новых групп и включить в них требуемого
пользователя. А для данных групп установить соответствующие права на объектах
файловой системы (утилиты `chmod` и `chown`).

