== Развёртывание офисной ИТ-инфраструктуры ==

=== Подготовка ===

Перед началом развёртывания офисной ИТ-инфраструктуры необходимо провести
детальное планирование. Конкретные решения в каждом случае будут диктоваться
спецификой требований, предъявляемым к офисной ИТ-инфраструктуре. Как будет
использоваться (DISTRO) в каждом конкретном случае решать
вам. При этом важно понимать, как взаимодействуют компьютеры сети друг с другом
и какова роль конкретного компьютера: главный сервер, подчинённый сервер или
компьютер-клиент (рабочее место).

Ключевым понятием для работы сети, построенной на базе (DISTRO),
является _домен_.

[[DOMAIN]]
==== Домен ====

Домен::
Под доменом понимается группа компьютеров с разными ролями.
Каждый сервер обслуживает один домен -- группу компьютеров одной сети, имеющую
единый центр и использующую единые базы данных для различных сетевых служб.

[NOTE]
Не путайте это понятие с другими доменами: почтовыми доменами, доменными именами
(DNS), Windows-доменами.

[[ROLES]]
=== Серверы, рабочие места и авторизация ===

Важно понимать роль, которая будет отводится (DISTRO) в
домене. Именно сервер под управлением (DISTRO) будет
являться центральным звеном сети,
контролируя доступ к ресурсам сети и сам предоставляя различные службы для
клиентских машин. Такой сервер называется _главный_. Однако в сети для
распределения нагрузки могут использоваться и дополнительные _подчинённые_
серверы. Все службы, предоставляемые серверами используются _рабочими местами_.

Таким образом можно выделить:

Сервер (компьютер под управлением (DISTRO))::
Главный;;
Главный сервер осуществляет контроль доступа к ресурсам сети, содержит
централизованную базу данных пользователей и _удостоверяющий центр_ для выдачи
сертификатов службам на серверах и рабочих местах.
Подчинённый;;
Подчинённый сервер может предоставлять какую-то службу в сети. Например,
являться почтовым сервером. Однако для обеспечения безопасности подчинённый
сервер должен подписать сертификаты своих служб и иметь возможность брать
необходимые данные с главного сервера. В приведённом примере подчинённый сервер
будет использовать базу данных пользователей с главного сервера.

Рабочее место::
Рабочие места -- это клиентские по отношению к серверам компьютеры,
непосредственно использующиеся для работы пользователями. Эти компьютеры
являются клиентскими по отношению к серверу. Для доступа к ресурсам сети
(например, общим файлам, расположенным на сервере, либо получения доступа в сеть
Интернет), пользователю, работающему на клиентском компьютере, необходимо
авторизоваться на сервере.

Наибольший эффект от использования (DISTRO) достигается при использовании
его вместе с рабочими местами под управлением дистрибутивов «Шестой платформы».
Они уже содержат всё необходимое для интеграции в сеть с (DISTRO).
Конечно, в качестве рабочих мест могут использоваться и другие операционные
системы. Однако часть возможностей и преимуществ при этом может быть потеряна,
любо потребовать дополнительной настройки на стороне компьютера-клиента.

Для получения доступа к ресурсам сети, человеку, работающему на клиентском
компьютере необходимо _авторизоваться_ -- это значит ввести свои данные (имя и
пароль), после проверки которых главным сервером пользователь получает тот объём
прав доступа к ресурсам сети, который определён администратором домена.

Авторизация::
В зависимости от специфики использования рабочего места можно выделить два
способа авторизации:
+
Мобильное рабочее место;;
Типичный пример -- ноутбук. То есть компьютер, который лишь на время
становится частью домена, в остальное же время работает как самостоятельный
компьютер с собственной локальной базой пользователей.
+
Для обеспечения авторизации на такого рода компьютерах устанавливается
дополнительное программное обеспечение (в виде апплета), которое позволяет уже
зарегистрированному в системе пользователю (с локальными учётными данными),
зарегистрироваться и в домене (с доменными аутентификационными данными).

Стационарное рабочее место;;
Типичный пример -- офисное рабочее место, постоянно находящееся в локальной сети.
В этом случае аутентификация в домене происходит непосредственно в момент
регистрации пользователя на рабочем месте (с доменными аутентификационными
данными).
Рабочие места под управлением дистрибутивов «Шестой платформы» позволяют легко
настроить такой способ аутентификации. Для этого при установке этого
дистрибутива или позже, в Центре управления системой (раздел *Аутентификация*)
на рабочей станции, нужно выбрать домен, управляемый (DISTRO).

После того, как вы определились со структурой вашей сети, можно переходить к
непосредственной настройке (DISTRO).

== Определение роли сервера ==

Для правильной настройки параметров безопасности после установки и
первоначальной настройки сервера, прежде всего необходимо определить
<<ROLES,роль>> этого сервера в домене: главный или подчинённый.

Если ваш домен пока обслуживается лишь главным сервером (подчинённых нет), вы
можете сразу переходить к следующему разделу <<LDAPUSERS, Централизованная база пользователей>>.

Если же в сети должны использоваться подчинённые серверы, то они должны быть
известны главному и для обеспечения безопасности домена должны находится с ним в
_доверительных отношениях_. Настройка доверительных отношений происходит в ЦУС в
модуле *Доверительные отношения* (раздел *Система*).

Несмотря на то, что для работоспособности домена достаточно настроить только
главный сервер, рекомендуется наличие одного или нескольких подчинённых для
распределения нагрузки.

Сервер становится подчинённым после указанных действий:

* На главном сервере: получить ключ хоста.
* На подчинённом сервере: загрузить полученный файл ключа.
* Во избежание подмены необходимо сверить ключи:
** Строку *Ключ хоста*, выводимую в таблице *Подчинённые серверы* (колонка
   *Серверы*) на главном сервере со строкой *Ключ хоста* на подчинённом
   сервере.
** Строку *Ключ хоста*, выводимую на главном сервере (над кнопкой *Скачать файл
   ключа*) и строку *Ключ главного сервера* на подчинённом сервере.
* На главном сервере: выбрать из списка подчинённых серверов тот, на который
  был загружен ключ и нажать *Подчинить выделенные*.
* На главном сервере: в модуле ЦУС *Удостоверяющий Центр* (в таблице *Управление сертификатами*)
  выбрать и подписать ключи служб подчинённого сервера.

За дополнительной информацией по настройке обращайтесь к встроенной справке
модуля ЦУС.

== Удостоверяющий Центр ==

Модуль *Удостоверяющий Центр* (раздел *Система*) является краеугольным камнем
организации доверительных отношений в домене, позволяет управлять
SSL-сертификатами, используемыми для обеспечения безопасных соединений между
сетевыми узлами.

Типичный пример: веб-браузер обращается к веб-серверу и при этом необходимо
передавать конфиденциальные данные (например, вводить пароли для доступа к
разделам сайта и т.п.). В этой ситуации важно, чтоб участвующие в передаче
данных стороны могли:

* быть уверенными в подлинности другой стороны;
* иметь возможность шифровать передаваемые данные.

Обе эти возможности обеспечиваются использованием сертификатов. Предназначение
сертификата сервера сродни роли документа, удостоверяющего личность, например,
паспорта. Паспорт должен однозначно идентифицировать человека и гарантировать
то, что он тот, за кого себя выдаёт. Так и сертификат однозначно подтверждает
подлинность сервера. Сертификат, как и паспорт, содержит всю необходимую для
подтверждения подлинности информацию о самом сервере. В обоих случаях есть
третья сторона, которая собственно и выступает в роли гаранта подлинности. Для
паспорта это подпись паспортного отдела. Для сертификата --
*Удостоверяющий центр* (УЦ), который поставил свою электронную подпись и таким
образом подтвердил подлинность сертификата.

Предоставляется три направления использования Удостоверяющего центра:

* Получение сертификата самого удостоверяющего центра.
+
Такой сертификат является самоподписанным, создаётся при начальной настройке
системы и может быть использован при определения уровня доверия к сертификатам,
которые были им подписаны (например, при создании VPN-соединения). Этот
сертификат можно загрузить на вкладке *Управление УЦ* (ссылка `ca-root.pem`).

* Подписывание сертификатов служб локального и подчинённых серверов.
+
В таблице *Управление сертификатами* нажмите на ссылку необходимого набора
сертификатов, например, *Локальные сертификаты*, установите флажки у
необходимых сертификатов и нажмите кнопку *Подписать*.

* Выдачи подписанных сертификатов по запросу.
+
Вы можете получить подписанный Удостоверяющим центром сертификат. Для этого
вам нужно иметь файл с расширением `.csr` (такой файл создаётся, к примеру,
на рабочих станциях при создании ключа в модуле *Управление ключами SSL*).
+
Укажите путь к файлу в подразделе *Подписать сертификат* и нажмите кнопку
*Загрузить запрос*. Будет показана информация о запросе. Если всё верно,
нажмите кнопку *Подписать*.

За дополнительной информацией по настройке обращайтесь к встроенной справке
модуля ЦУС.

[[LDAPUSERS]]
== Централизованная база пользователей ==

Основной идеей <<DOMAIN,домена>> является единая база учётных записей. При такой
организации работы пользователям требуется лишь одна единственная учётная запись
для доступа ко всем разрешённым администратором сети ресурсам. Наличие в сети
единой централизованной базы пользователей позволяет значительно упростить
работу как самих пользователей, так и системных администраторов.

=== Создание учётных записей пользователей ===

Централизованная база пользователей создаётся на главном сервере. Наполнить её
учётными записям можно воспользовавшись модулем ЦУС *Пользователи* (раздел
*Пользователи*). После создания учётной записи пользователя не забудьте
присвоить учётной записи пароль. Этот пароль и будет использоваться
пользователем для регистрации в домене. После этого на рабочих местах под
управлением дистрибутивов «Шестой платформы», на которых для аутентификации
установлен этот домен, можно вводить это имя пользователя и пароль.

=== Объединение пользователей в группы ===

Пользователи могут быть объединены в группы. Это может быть полезно для более
точного распределения полномочий пользователей. Например, члены группы `wheel`
могут получать полномочия администратора на локальной машине, выполнив команду
`su -`. Настройка групп производится в модуле ЦУС *Группы* (раздел
*Пользователи*).

За дополнительной информацией по настройке обращайтесь к встроенной справке
соответствующих модулей ЦУС.

== Организация сетевой инфраструктуры ==

(DISTRO) в сети организации может быть использован для
решения различных задач. Он может предоставлять компьютерам сети общий доступ в
Интернет, выступать в роли почтового сервера, файлового хранилища, веб-сервера и
т.д.. Все эти возможности обеспечиваются соответствующими _службами_,
запускаемыми на сервере. Для выбора и настройки необходимых служб воспользуйтесь
*Центром управления системой*.

Дальнейшие разделы описываются некоторые возможности использования (DISTRO),
настраиваемые в ЦУС.

== Настройка подключения к Интернету ==

Помимо множества различных служб, которые (DISTRO) может
предоставлять компьютерам сети, важно определить, будет ли сервер предоставлять
общий доступ в Интернет для компьютеров домена или нет. В зависимости от этого
сервер можно рассматривать как:

Сервер без подключения к сети Интернет::
  Типичный случай -- это сервер с одним сетевым интерфейсом (одной
  сетевой картой), который и связывает его с компьютерами локальной сети.
  Такой сервер называется также _сервер рабочей группы_.

Шлюз::
  В этом случае сервер обычно имеет два сетевых интерфейса (например, две
  сетевые карты), одна из которых служит для подключения к локальной сети, а
  другая -- для подключения к сети Интернет.

[[SETUP_INET_CONNECTION]]
Как для обеспечения доступа в сеть Интернет самого (DISTRO),
так и для настройки общего выхода в Интернет для компьютеров сети
необходимо настроить подключение к Интернету на самом сервере. (DISTRO)
поддерживает самые разные способы подключения к сети Интернет:

* Ethernet;
* PPTP;
* PPPoЕ;
* и т.д.

Для настройки конкретного подключения воспользуйтесь разделом ЦУС *Сеть*, выбрав
модуль, соответствующий вашему типу подключения.

За дополнительной информацией по настройке обращайтесь к встроенной справке
соответствующих модулей ЦУС.

=== Настройка общего подключения к сети Интернет ===

Пользователи корпоративных сетей обычно подключаются к сети Интернет через один
общий канал. Для организации совместного доступа к сети Интернет стандартными
средствами поддерживаются две технологии, которые могут использоваться как по
отдельности, так и совместно:

* <<PROXY,использование прокси-сервера>>;
* <<NAT,использование NAT>>.

Оба способа предполагают, что соединение с Интернет самого компьютера, через
который предполагается настроить общий выход, предварительно
<<SETUP_INET_CONNECTION,сконфигурировано>>. Сделать это можно в разделе ЦУС
*Сеть*.

[[NAT]]
==== NAT ====

NAT (Network Address Translation, преобразование сетевых адресов) -- это
механизм в сетях TCP/IP, позволяющий преобразовывать IP-адреса транзитных
пакетов. Таким образом компьютеры локальной сети, имеющие IP-адреса,
зарезервированные для использования исключительно в локальных сетях, могут
использовать общий канал доступа к Интернет (общий внешний IP-адрес). При этом
на компьютере-шлюзе, непосредственно подключённом к Интернет, выполняется
преобразование адресов.

Настройка NAT осуществляется в модуле ЦУС *Внешние сети* (раздел *Брандмауэр*). Для минимальной
настройки достаточно выбрать режим работы *Шлюз (NAT)*, отметить правильный внешний
сетевой интерфейс и нажать на кнопку *Применить*.

За дополнительной информацией по настройке обращайтесь к встроенной справке
модуля ЦУС.

== Автоматическое присваивание IP-адресов (DHCP-сервер) ==

DHCP-сервер -- это служба, позволяющая компьютерам автоматически получать
IP-адрес и другие параметры, необходимые для работы в сети TCP/IP. Это облегчает
администрирование клиентских машин избавляя администратора домена от
необходимости вручную настраивать сетевые интерфейсы на компьютерах локальной
сети.

Настройка DHCP-сервера осуществляется в модуле ЦУС *DHCP-сервер* (раздел
*Серверы*). Здесь вы можете включить службу, задать диапазон динамических
адресов, определить статические адреса и настроить прочие параметры.

Для включения DHCP-сервера установите флажок *Включить службу DHCP*, укажите
начальный и конечный IP-адрес и шлюз по умолчанию (обычно, это IP-адрес
сервера на сетевом интерфейсе, обслуживающем локальную сеть).

За дополнительной информацией по настройке обращайтесь к встроенной справке
модуля ЦУС.

== Сервер обновлений для машин локальной сети ==

Сервер обновлений -- технология, позволяющая настроить автоматическое обновление
программного обеспечения, установленного на клиентских машинах (рабочих местах),
работающих под управлением дистрибутивов «Шестой платформы».

Для операционных систем, установленных на клиентских машинах, постоянно
выпускаются обновления программного обеспечения. Это могут быть как обновления,
связанные с безопасностью, так и новый функционал или просто улучшение и
ускорение алгоритмов. В любом случае настоятельно рекомендуется регулярно
обновлять рабочие места для повышения надёжности работы.

Сервер обновлений предоставляет возможность автоматически настроить обновление
клиентских машин в нужном режиме:

Локальное зеркало репозитория::
В этом режиме на сервере создаётся копия удалённого репозитория, доступная
клиентским машинам по протоколу FTP. Загрузка ПО клиентскими машинами
производится с локального сервера. Наличие на локальном сервере зеркала
репозитория при большом количестве машин в сети позволяет существенно сэкономить
на трафике.

Публикация репозитория::
В этом случае реального зеркалирования (загрузки пакетов) не происходит.
Публикуется URL внешнего сервера, содержащего репозиторий. Такая публикация
позволяет клиентским машинам автоматически настроить свои менеджеры пакетов на
использование внешнего сервера. Загрузка ПО клиентскими машинами производится с
внешнего сервера.

Со стороны (DISTRO) настройка производится в модуле
управления *Сервер обновлений* (раздел *Система*). Помимо метода публикации
репозитория вы можете
настроить и дополнительные параметры, такие как: расписание зеркалирования,
выбор конкретных репозиториев для публикации и пр.

За дополнительной информацией по настройке обращайтесь к встроенной справке
модуля ЦУС.

Со стороны клиентских машин на них необходимо настроить модуль *Обновление
системы* отметив в нём *Обновление системы управляемое сервером*.

== Сетевая установка операционной системы на рабочие места ==

(DISTRO) позволяет организовать сетевую установку рабочих
рабочих мест.
Для этого на стороне сервера необходимо наличие образа установочного диска, а
для начала установки операционной системы на клиентской машине достаточно лишь
включить на ней в BIOS загрузку по сети.

Для организации такого рода сетевых установок в (DISTRO)
предусмотрен модуль ЦУС *Сервер сетевых установок* (раздел *Серверы*). Он
позволяет поместить на сервер как готовый образ ISO установочного диска, так и
создать такой образ с установочного диска CD или DVD, помещённого в привод.

За дополнительной информацией по настройке обращайтесь к встроенной справке
модуля ЦУС.

=== Сервер электронной почты ===

После установки сервера и первоначальной настройки, вы уже имеете
преднастроенный почтовый сервер, обслуживающий почтовый домен, указанный при
первоначальной настройке в поле *домен*.

(DISTRO) может служить как почтовым сервером,
обслуживающим определённый домен так и посредником (шлюзом) для пересылки
почты. Почтовый сервер отвечает как за отправку писем (SMTP-сервер)
исходящих от почтовых клиентов рабочих станций, так и за предоставление
им входящей почты (Сервер POP3/IMAP).

Для настройки параметров работы сервера предусмотрен модуль ЦУС *Почтовый
сервер* (раздел *Серверы*).

=== Сервер SMTP ===

Сервер SMTP отвечает за отправку сообщений и может работать в двух режимах:

Посредник::
  В этом режиме исходящая почта пересылается для дальнейшей отправки на
  указанный сервер.
Сервер::
  В этом режиме сервер доставляет почту самостоятельно.

=== Сервер POP3/IMAP ===

Сервер POP3/IMAP используется для доступа пользователей к электронной почте на
сервере.

Для доступа к службам POP3 и IMAP пользователь должен включить в своём почтовом
клиенте аутентификацию и указать своё имя и пароль. Выбор конкретного
используемого протокола для получения почты зависит от предпочтений
пользователя.

POP::
  При проверке почты почтовым клиентом  почта передаётся на клиентскую машину,
  где и сохраняется. Возможность просмотра принятой/отправленной почты при этом
  существует даже, если клиент не имеет соединения с сервером.
IMAP::
  Все сообщения хранятся на сервере. Почтовый клиент может просматривать их
  только при наличии соединения с сервером.

Помимо включения/отключения служб, модуль ЦУС *Почтовый сервер* позволяет
произвести дополнительные настройки: фильтрацию спама, настройку параметров
аутентификации и т.д.

За дополнительной информацией по использованию модуля обращайтесь к встроенной
справке модуля ЦУС.

== Соединение удалённых офисов (OpenVPN-сервер) ==

(DISTRO) предоставляет возможность безопасного соединения
удалённых офисов используя технологию `VPN` (англ. Virtual Private Network --
виртуальная частная сеть), которая позволяет организовать безопасные шифрованные
соединения через публичные сети (например, Интернет) между удалёнными офисами
или локальной сетью и удалёнными пользователями. Таким образом, вы можете
связать два офиса организации, что, например, делает работу с
документами, расположенными в сети удалённого офиса, более удобной.

Помимо соединения целых офисов, также существует возможность организовать
доступ в офисную сеть для работы в ней извне. Это означает, например, что
сотрудник можете работать в своём привычном окружении, даже находясь в
командировке либо просто из дома.

Для организации подобного рода соединения на стороне сервера предусмотрен модуль
ЦУС *OpenVPN-сервер* (раздел *Серверы*). Особое внимание при планировании и
настройке подключений следует обратить на используемые сети. Они _не должны_
пересекаться.

Для создания соединения установите флажок *Включить службу OpenVPN*, выберите
тип *Маршрутизируемое (TUN)*, проверьте открываемую по соединению сеть (обычно
это локальная сеть в виде IP-адреса и маски подсети). Помимо этого нужно
подписать ключ *openvpn* в модуле *Удостоверяющий Центр* (раздел *Система*).
После этого нажмите на кнопку *Применить*. Доступ к настроенной приватной сети
могут получить пользователи, подписавшие свои ключи и получившие сертификат
в удостоверяющем центре на том же сервере.

Если необходимо организовать защищённое соединение между двумя локальными
сетями, воспользуйтесь модулем *OpenVPN-соединения* (раздел *Сеть*).

За дополнительной информацией по настройке обращайтесь к встроенной справке
модуля ЦУС.

Со стороны клиента соединения настраивается в модуле ЦУС *OpenVPN-соединения*.

== Доступ к службам сервера из сети Интернет ==

Сервер предоставляет возможность организовать доступ к своим службам извне.
Например, можно предоставить доступ к корпоративному веб-сайту из сети Интернет.
Для обеспечения такой возможности необходимо разрешить входящие соединения на
внешних интерфейсах. По умолчанию такие соединения блокируются.

Для разрешения внешних и внутренних входящих соединений предусмотрен раздел ЦУС *Брандмауэр*.
В списке *Разрешить входящие соединения на внешних интерфейсаx* модуля *Внешние сети*
перечислены наиболее часто используемые службы, отметив которые, вы делаете их
доступными для соединений на внешних сетевых интерфейсах. Если вы хотите
предоставить доступ к службе, отсутствующей в списке, задайте используемые этой
службой порты в соответствующих полях.

За дополнительной информацией по настройке обращайтесь к встроенной справке
модуля ЦУС.

=== Список блокируемых хостов ===

Модуль ЦУС *Список блокируемых хостов* предназначен для блокирования любого трафика с
указанными узлами.  Данный модуль позволяет блокировать любой сетевой трафик с
указанными в списке узлами (входящий, исходящий и пересылаемый).  Блокирование
трафика с указанными в списке узлами начинается после установки флажка
*Использовать чёрный список*. Для добавления блокируемого узла введите IP-адрес
или имя узла в поле под списком и нажмите кнопку *Добавить*.  Для удаления узла
из списка выберите его и нажмите кнопку *Удалить*.

== Статистика ==

=== Сетевой трафик ===

Все входящие и исходящие с сервера сетевые пакеты могут подсчитываться и
выводится по запросу для анализа.  Можно оценить итоговый объём полученных и
переданных данных за всё время работы сервера или за определённый период
времени.

Для включения этой возможности и просмотра статистики воспользуйтесь модулем ЦУС
*Сетевой трафик* (раздел *Статистика*).

Для включения сбора данных установите флажок *Включить сбор данныx*, затем нажмите
кнопку *Применить*.

Для просмотра статистики укажите период (с даты по дату). Дата указывается в
формате YYYY-MM-DD (год-месяц-день) или выбирается из календаря справа от поля
ввода даты. Из списка доступных сетевых интерфейсов выберите интересующий и
нажмите на кнопку *Показать*.

Трафик на указанном интерфейсе за заданный период показывается в виде:

* Служба (название протокола)
* Входящий трафик в килобайтах
* Исходящий трафик в килобайтах

[[PROXY]]
=== Прокси-сервер ===

Пересылка каждого запроса во внешнюю сеть фиксируется прокси-сервером в
специальном журнале. На основании этих данных автоматически формируются отчёты о
статистике использования ресурсов сети, в том числе потраченного времени и
количества переданных данных (трафика).

Для включения сбора статистики и просмотра отчётов воспользуйтесь модулем ЦУС
*Прокси-сервер* (раздел *Статистика*).

Для включения сбора статистики прокси-сервера установите флажок *Включить сбор
данных прокси-сервера*.

В том случае, если на прокси-сервере производилась аутентификация пользователей,
отчёты будут содержать данные об обращениях каждого пользователя. Иначе отчёты
будут формироваться только на основании адресов локальной сети.

Для показа отчёта установите условия фильтра и нажмите кнопку *Показать*. Данные
в таблице отсортированы по объёму трафика по убыванию.
